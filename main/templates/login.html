{% extends 'base.html' %}
{% load static %}

{% block meta %}
<title>Masuk - ASKMO</title>
{% endblock meta %}

{% block content %}


<div class="w-full min-h-screen flex items-center justify-center p-4 font-['Plus_Jakarta_Sans']">
  <div class="max-w-md w-full bg-[#353535] backdrop-blur-lg rounded-2xl p-8">
    <div class="text-center mb-8">
      <h1 class="text-3xl font-bold text-white mb-2">Masuk</h1>
      <p class="text-gray-300">Selamat datang kembali di ASKMO</p>
    </div>

    <div id="login-errors" class="mb-4"></div>
    
    <!-- Login Form -->
    <form id="login-form" method="POST" class="space-y-6">
      {% csrf_token %}
      <div>
        <label for="username" class="block text-sm font-medium text-gray-300 mb-2">Username</label>
        <input id="username" name="username" type="text" required class="w-full px-4 py-3 bg-white/5 border border-white/20 rounded-md text-white placeholder:text-gray-400 focus:outline-none focus:border-2 focus:border-[#06005E] transition-colors" placeholder="Masukkan username Anda">
      </div>
      <div>
        <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Kata Sandi</label>
        <input id="password" name="password" type="password" required class="w-full px-4 py-3 bg-white/5 border border-white/20 rounded-md text-white placeholder:text-gray-400 focus:outline-none focus:border-2 focus:border-[#06005E] transition-colors" placeholder="Masukkan kata sandi Anda">
      </div>
      
      <!-- Masuk -->
      <button type="submit" class="w-full bg-gradient-to-r from-[#06005E] to-[#571E88] hover:from-[#1A107A] hover:to-[#7A3EAA] text-white font-semibold py-3 px-4 rounded-md transition-colors duration-300">
        Masuk
      </button>
    </form>

    <div class="mt-6 text-center pt-6 border-t border-white/20">
      <p class="text-gray-400 text-sm">
        Belum punya akun? 
        <a href="{% url 'main:register' %}" class="text-[#A4E4FF] hover:text-[#939393] font-medium transition-colors underline">
          Daftar akun disini!
        </a>
      </p>
    </div>
  </div>
</div>

<script>
  document.getElementById('login-form').addEventListener('submit', async function(e) {
      e.preventDefault();

      const form = e.target;
      const username = form.username.value;
      const password = form.password.value;
      const errorContainer = document.getElementById('login-errors');
      errorContainer.innerHTML = '';

      try {
          const response = await fetch("{% url 'main:login_ajax' %}", {
              method: "POST", 
              headers: {
                  "Content-Type": "application/json",
                  "X-CSRFToken": getCookie('csrftoken') 
              },
              body: JSON.stringify({
                  username: username,
                  password: password
              })
          });
          const result = await response.json();

          if (result.status === 'success') {
              showToast(result.message, 'success');
              setTimeout(() => { 
                  window.location.href = "{% url 'main:show_main' %}";
              }, 1500);
          } else {
              showToast(result.message || 'Login failed.', 'error');
              const errorElement = document.createElement('div');
              errorElement.className = 'px-4 py-3 rounded text-sm border bg-red-50 border-red-200 text-red-700';
              errorElement.textContent = result.message;
              errorContainer.appendChild(errorElement);
          }
      } catch (error) {
          showToast('Terjadi kesalahan yang tidak terduga.', 'error');
      }
  });
</script>
{% endblock content %}