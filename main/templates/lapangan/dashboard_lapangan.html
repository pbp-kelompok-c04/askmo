{% extends 'base.html' %}
{% load static %}

{% block meta %}
    <title>Lapangan - ASKMO</title>

    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        #modal-overlay {
            display: none; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8); 
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        #modal-content {
            background: #1A1A1A; 
            border-radius: 20px;
            width: 100%;
            max-width: 600px; 
            max-height: 90vh; 
            overflow-y: auto; 
            color: #fff;
            position: relative;
            border: 1px solid #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            scrollbar-width: none;
        }

        #modal-content::-webkit-scrollbar {
        display: none;
        }

        #modal-close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #888;
            font-size: 1.8rem;
            cursor: pointer;
            transition: color 0.2s;
        }
        #modal-close-btn:hover {
            color: #fff;
        }
        
        #modal-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 20px 20px 0 0;
        }

        .modal-body {
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        #modal-nama {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1.2;
        }
        
        .modal-priority-info {
            display: flex;
            flex-direction: column;
            gap: 10px;
            font-size: 1rem;
            color: #CFCFCF;
        }
        
        .modal-priority-info p {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .modal-priority-info i {
            width: 20px; 
            text-align: center;
            color: #888;
        }
        
        .modal-divider {
            border: 0;
            height: 1px;
            background: #333;
            margin: 10px 0;
        }
        
        .modal-details {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .modal-details h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #fff;
        }
        
        .modal-details p {
            font-size: 0.95rem;
            color: #CFCFCF;
            line-height: 1.6;
            white-space: pre-wrap; 
        }
        
        #modal-kontak-btn {
            display: inline-block;
            text-decoration: none;
            padding: 12px 20px;
            background: #571E88; 
            color: #fff;
            font-weight: 600;
            border-radius: 10px;
            text-align: center;
            margin-top: 10px;
            transition: background 0.2s;
        }
        #modal-kontak-btn:hover {
            background: #7A3EAA;
        }
        .is-saved {
            color: #efdf84 !important;
        }
        .search-container {
            display: flex; 
            gap: 15px; 
            align-items: center;
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
            padding: 0 20px;
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;    
        }
    </style>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}
<div class="fixed top-9 right-9 z-50 hidden md:block">
    <a href="{% url 'main:show_profile' %}">
        <div class="flex items-center space-x-2 px-4 py-2 text-[#CFCFCF] text-sm font-medium">
        <span>{{ user.username }}</span>
        </div>
    </a>
</div>
    <main>

        <h1 class="text-white" style="margin-top: 70px; margin-bottom: 15px; font-size: 40px; text-align: center;"><b>LAPANGAN</b></h1>
        <div class="bg-[#353535] rounded-xl p-4 mb-8">
            <form class="grid grid-cols-1 md:grid-cols-7 gap-4 items-center" method="GET" action="{% url 'main:show_lapangan_dashboard' %}">
                
                <div class="relative md:col-span-2">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <i class="fas fa-search w-5 h-5 text-white opacity-75"></i>
                    </div>
                    <input type="text" name="nama" class="w-full pl-10 pr-4 py-3 bg-[#4F4F4F] border border-transparent rounded-md text-white placeholder:text-white focus:outline-none focus:border-[#06005E] focus:border-[2px]" placeholder="Cari nama lapangan" value="{{ search_values.nama }}">
                </div>

                <div class="relative md:col-span-2">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <i class="fas fa-map-marker-alt w-5 h-5 text-white opacity-75"></i>
                    </div>
                    <select name="kecamatan" 
                            class="w-full pl-10 pr-4 py-3 bg-[#4F4F4F] border border-transparent rounded-md text-white appearance-none focus:outline-none" 
                            style="color-scheme: dark;">
                        <option value="">Pilih lokasi</option>
                        <optgroup label="Jakarta Pusat">
                            <option value="Cempaka Putih" {% if search_values.kecamatan == 'Cempaka Putih' %}selected{% endif %}>Cempaka Putih</option>
                            <option value="Gambir" {% if search_values.kecamatan == 'Gambir' %}selected{% endif %}>Gambir</option>
                            <option value="Johar Baru" {% if search_values.kecamatan == 'Johar Baru' %}selected{% endif %}>Johar Baru</option>
                            <option value="Kemayoran" {% if search_values.kecamatan == 'Kemayoran' %}selected{% endif %}>Kemayoran</option>
                            <option value="Menteng" {% if search_values.kecamatan == 'Menteng' %}selected{% endif %}>Menteng</option>
                            <option value="Sawah Besar" {% if search_values.kecamatan == 'Sawah Besar' %}selected{% endif %}>Sawah Besar</option>
                            <option value="Senen" {% if search_values.kecamatan == 'Senen' %}selected{% endif %}>Senen</option>
                            <option value="Tanah Abang" {% if search_values.kecamatan == 'Tanah Abang' %}selected{% endif %}>Tanah Abang</option>
                        </optgroup>
                        <optgroup label="Jakarta Utara">
                            <option value="Cilincing" {% if search_values.kecamatan == 'Cilincing' %}selected{% endif %}>Cilincing</option>
                            <option value="Kelapa Gading" {% if search_values.kecamatan == 'Kelapa Gading' %}selected{% endif %}>Kelapa Gading</option>
                            <option value="Koja" {% if search_values.kecamatan == 'Koja' %}selected{% endif %}>Koja</option>
                            <option value="Pademangan" {% if search_values.kecamatan == 'Pademangan' %}selected{% endif %}>Pademangan</option>
                            <option value="Penjaringan" {% if search_values.kecamatan == 'Penjaringan' %}selected{% endif %}>Penjaringan</option>
                            <option value="Tanjung Priok" {% if search_values.kecamatan == 'Tanjung Priok' %}selected{% endif %}>Tanjung Priok</option>
                        </optgroup>
                        <optgroup label="Jakarta Timur">
                            <option value="Cakung" {% if search_values.kecamatan == 'Cakung' %}selected{% endif %}>Cakung</option>
                            <option value="Cipayung" {% if search_values.kecamatan == 'Cipayung' %}selected{% endif %}>Cipayung</option>
                            <option value="Ciracas" {% if search_values.kecamatan == 'Ciracas' %}selected{% endif %}>Ciracas</option>
                            <option value="Duren Sawit" {% if search_values.kecamatan == 'Duren Sawit' %}selected{% endif %}>Duren Sawit</option>
                            <option value="Jatinegara" {% if search_values.kecamatan == 'Jatinegara' %}selected{% endif %}>Jatinegara</option>
                            <option value="Kramat Jati" {% if search_values.kecamatan == 'Kramat Jati' %}selected{% endif %}>Kramat Jati</option>
                            <option value="Makasar" {% if search_values.kecamatan == 'Makasar' %}selected{% endif %}>Makasar</option>
                            <option value="Matraman" {% if search_values.kecamatan == 'Matraman' %}selected{% endif %}>Matraman</option>
                            <option value="Pasar Rebo" {% if search_values.kecamatan == 'Pasar Rebo' %}selected{% endif %}>Pasar Rebo</option>
                            <option value="Pulo Gadung" {% if search_values.kecamatan == 'Pulo Gadung' %}selected{% endif %}>Pulo Gadung</option>
                        </optgroup>
                        <optgroup label="Jakarta Selatan">
                            <option value="Cilandak" {% if search_values.kecamatan == 'Cilandak' %}selected{% endif %}>Cilandak</option>
                            <option value="Jagakarsa" {% if search_values.kecamatan == 'Jagakarsa' %}selected{% endif %}>Jagakarsa</option>
                            <option value="Kebayoran Baru" {% if search_values.kecamatan == 'Kebayoran Baru' %}selected{% endif %}>Kebayoran Baru</option>
                            <option value="Kebayoran Lama" {% if search_values.kecamatan == 'Kebayoran Lama' %}selected{% endif %}>Kebayoran Lama</option>
                            <option value="Mampang Prapatan" {% if search_values.kecamatan == 'Mampang Prapatan' %}selected{% endif %}>Mampang Prapatan</option>
                            <option value="Pancoran" {% if search_values.kecamatan == 'Pancoran' %}selected{% endif %}>Pancoran</option>
                            <option value="Pasar Minggu" {% if search_values.kecamatan == 'Pasar Minggu' %}selected{% endif %}>Pasar Minggu</option>
                            <option value="Pesanggrahan" {% if search_values.kecamatan == 'Pesanggrahan' %}selected{% endif %}>Pesanggrahan</option>
                            <option value="Setiabudi" {% if search_values.kecamatan == 'Setiabudi' %}selected{% endif %}>Setiabudi</option>
                            <option value="Tebet" {% if search_values.kecamatan == 'Tebet' %}selected{% endif %}>Tebet</option>
                        </optgroup>
                        <optgroup label="Jakarta Barat">
                            <option value="Cengkareng" {% if search_values.kecamatan == 'Cengkareng' %}selected{% endif %}>Cengkareng</option>
                            <option value="Grogol Petamburan" {% if search_values.kecamatan == 'Grogol Petamburan' %}selected{% endif %}>Grogol Petamburan</option>
                            <option value="Taman Sari" {% if search_values.kecamatan == 'Taman Sari' %}selected{% endif %}>Taman Sari</option>
                            <option value="Tambora" {% if search_values.kecamatan == 'Tambora' %}selected{% endif %}>Tambora</option>
                            <option value="Kebon Jeruk" {% if search_values.kecamatan == 'Kebon Jeruk' %}selected{% endif %}>Kebon Jeruk</option>
                            <option value="Kalideres" {% if search_values.kecamatan == 'Kalideres' %}selected{% endif %}>Kalideres</option>
                            <option value="Palmerah" {% if search_values.kecamatan == 'Palmerah' %}selected{% endif %}>Palmerah</option>
                            <option value="Kembangan" {% if search_values.kecamatan == 'Kembangan' %}selected{% endif %}>Kembangan</option>
                        </optgroup>
                        <optgroup label="Kepulauan Seribu">
                            <option value="Kepulauan Seribu Utara" {% if search_values.kecamatan == 'Kepulauan Seribu Utara' %}selected{% endif %}>Kepulauan Seribu Utara</option>
                            <option value="Kepulauan Seribu Selatan" {% if search_values.kecamatan == 'Kepulauan Seribu Selatan' %}selected{% endif %}>Kepulauan Seribu Selatan</option>
                        </optgroup>
                        <optgroup label="Tangerang Kota">
                            <option value="Batuceper" {% if search_values.kecamatan == 'Batuceper' %}selected{% endif %}>Batuceper</option>
                            <option value="Benda" {% if search_values.kecamatan == 'Benda' %}selected{% endif %}>Benda</option>
                            <option value="Cibodas" {% if search_values.kecamatan == 'Cibodas' %}selected{% endif %}>Cibodas</option>
                            <option value="Ciledug" {% if search_values.kecamatan == 'Ciledug' %}selected{% endif %}>Ciledug</option>
                            <option value="Cipondoh" {% if search_values.kecamatan == 'Cipondoh' %}selected{% endif %}>Cipondoh</option>
                            <option value="Jatiuwung" {% if search_values.kecamatan == 'Jatiuwung' %}selected{% endif %}>Jatiuwung</option>
                            <option value="Karangtengah" {% if search_values.kecamatan == 'Karangtengah' %}selected{% endif %}>Karangtengah</option>
                            <option value="Karawaci" {% if search_values.kecamatan == 'Karawaci' %}selected{% endif %}>Karawaci</option>
                            <option value="Larangan" {% if search_values.kecamatan == 'Larangan' %}selected{% endif %}>Larangan</option>
                            <option value="Neglasari" {% if search_values.kecamatan == 'Neglasari' %}selected{% endif %}>Neglasari</option>
                            <option value="Periuk" {% if search_values.kecamatan == 'Periuk' %}selected{% endif %}>Periuk</option>
                            <option value="Pinang" {% if search_values.kecamatan == 'Pinang' %}selected{% endif %}>Pinang</option>
                            <option value="Tangerang" {% if search_values.kecamatan == 'Tangerang' %}selected{% endif %}>Tangerang</option>
                        </optgroup>
                        <optgroup label="Tangerang Selatan">
                            <option value="Ciputat" {% if search_values.kecamatan == 'Ciputat' %}selected{% endif %}>Ciputat</option>
                            <option value="Ciputat Timur" {% if search_values.kecamatan == 'Ciputat Timur' %}selected{% endif %}>Ciputat Timur</option>
                            <option value="Pamulang" {% if search_values.kecamatan == 'Pamulang' %}selected{% endif %}>Pamulang</option>
                            <option value="Pondok Aren" {% if search_values.kecamatan == 'Pondok Aren' %}selected{% endif %}>Pondok Aren</option>
                            <option value="Serpong" {% if search_values.kecamatan == 'Serpong' %}selected{% endif %}>Serpong</option>
                            <option value="Serpong Utara" {% if search_values.kecamatan == 'Serpong Utara' %}selected{% endif %}>Serpong Utara</option>
                            <option value="Setu" {% if search_values.kecamatan == 'Setu' %}selected{% endif %}>Setu</option>
                        </optgroup>
                        <optgroup label="Bekasi">
                            <option value="Bantargebang" {% if search_values.kecamatan == 'Bantargebang' %}selected{% endif %}>Bantargebang</option>
                            <option value="Bekasi Barat" {% if search_values.kecamatan == 'Bekasi Barat' %}selected{% endif %}>Bekasi Barat</option>
                            <option value="Bekasi Selatan" {% if search_values.kecamatan == 'Bekasi Selatan' %}selected{% endif %}>Bekasi Selatan</option>
                            <option value="Bekasi Timur" {% if search_values.kecamatan == 'Bekasi Timur' %}selected{% endif %}>Bekasi Timur</option>
                            <option value="Bekasi Utara" {% if search_values.kecamatan == 'Bekasi Utara' %}selected{% endif %}>Bekasi Utara</option>
                            <option value="Jatiasih" {% if search_values.kecamatan == 'Jatiasih' %}selected{% endif %}>Jatiasih</option>
                            <option value="Jatisampurna" {% if search_values.kecamatan == 'Jatisampurna' %}selected{% endif %}>Jatisampurna</option>
                            <option value="Medansatria" {% if search_values.kecamatan == 'Medansatria' %}selected{% endif %}>Medansatria</option>
                            <option value="Mustikajaya" {% if search_values.kecamatan == 'Mustikajaya' %}selected{% endif %}>Mustikajaya</option>
                            <option value="Pondok Gede" {% if search_values.kecamatan == 'Pondok Gede' %}selected{% endif %}>Pondok Gede</option>
                            <option value="Pondokmelati" {% if search_values.kecamatan == 'Pondokmelati' %}selected{% endif %}>Pondokmelati</option>
                            <option value="Rawalumbu" {% if search_values.kecamatan == 'Rawalumbu' %}selected{% endif %}>Rawalumbu</option>
                        </optgroup>
                        <optgroup label="Bogor">
                            <option value="Bogor Barat" {% if search_values.kecamatan == 'Bogor Barat' %}selected{% endif %}>Bogor Barat</option>
                            <option value="Bogor Selatan" {% if search_values.kecamatan == 'Bogor Selatan' %}selected{% endif %}>Bogor Selatan</option>
                            <option value="Bogor Tengah" {% if search_values.kecamatan == 'Bogor Tengah' %}selected{% endif %}>Bogor Tengah</option>
                            <option value="Bogor Timur" {% if search_values.kecamatan == 'Bogor Timur' %}selected{% endif %}>Bogor Timur</option>
                            <option value="Bogor Utara" {% if search_values.kecamatan == 'Bogor Utara' %}selected{% endif %}>Bogor Utara</option>
                            <option value="Bojonggede" {% if search_values.kecamatan == 'Bojonggede' %}selected{% endif %}>Bojonggede</option>
                            <option value="Caringin" {% if search_values.kecamatan == 'Caringin' %}selected{% endif %}>Caringin</option>
                            <option value="Ciampea" {% if search_values.kecamatan == 'Ciampea' %}selected{% endif %}>Ciampea</option>
                            <option value="Ciawi" {% if search_values.kecamatan == 'Ciawi' %}selected{% endif %}>Ciawi</option>
                            <option value="Cisarua" {% if search_values.kecamatan == 'Cisarua' %}selected{% endif %}>Cisarua</option>
                            <option value="Gunung Putri" {% if search_values.kecamatan == 'Gunung Putri' %}selected{% endif %}>Gunung Putri</option>
                            <option value="Jonggol" {% if search_values.kecamatan == 'Jonggol' %}selected{% endif %}>Jonggol</option>
                            <option value="Parung" {% if search_values.kecamatan == 'Parung' %}selected{% endif %}>Parung</option>
                        </optgroup>
                        <optgroup label="Depok">
                            <option value="Beji" {% if search_values.kecamatan == 'Beji' %}selected{% endif %}>Beji</option>
                            <option value="Bojongsari" {% if search_values.kecamatan == 'Bojongsari' %}selected{% endif %}>Bojongsari</option>
                            <option value="Cilodong" {% if search_values.kecamatan == 'Cilodong' %}selected{% endif %}>Cilodong</option>
                            <option value="Cimanggis" {% if search_values.kecamatan == 'Cimanggis' %}selected{% endif %}>Cimanggis</option>
                            <option value="Cinere" {% if search_values.kecamatan == 'Cinere' %}selected{% endif %}>Cinere</option>
                            <option value="Cipayung" {% if search_values.kecamatan == 'Cipayung' %}selected{% endif %}>Cipayung</option>
                            <option value="Limo" {% if search_values.kecamatan == 'Limo' %}selected{% endif %}>Limo</option>
                            <option value="Sawangan" {% if search_values.kecamatan == 'Sawangan' %}selected{% endif %}>Sawangan</option>
                            <option value="Sukmajaya" {% if search_values.kecamatan == 'Sukmajaya' %}selected{% endif %}>Sukmajaya</option>
                            <option value="Tapos" {% if search_values.kecamatan == 'Tapos' %}selected{% endif %}>Tapos</option>
                        </optgroup>
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>

                <div class="relative md:col-span-2">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                        <i class="fas fa-futbol w-5 h-5 text-white opacity-75"></i>
                    </div>
                    <select name="olahraga" class="w-full pl-10 pr-4 py-3 bg-[#4F4F4F] border border-transparent rounded-md text-white appearance-none focus:outline-none">
                        <option value="" disabled {% if not search_values.olahraga %}selected{% endif %}>
                            Pilih cabang olahraga
                        </option>
                        {% for value, display in olahraga_choices %}
                            <option value="{{ value }}" {% if search_values.olahraga == value %}selected{% endif %}>
                                {{ display }}
                            </option>
                        {% endfor %}
                    </select>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-white">
                        <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                    </div>
                </div>

                <button type="submit" class="md:col-span-1 w-full bg-[#06005E] hover:bg-[#1A107A] text-white font-semibold py-3 px-4 rounded-md transition-colors duration-300">
                    Cari
                </button>
            </form>
        </div>
        <div class="card-container">
            {% for lapangan in lapangan_list %}
            <div class="card">
                {% if lapangan.thumbnail %}
                    <img src="{{ lapangan.thumbnail }}" alt="Foto {{ lapangan.nama }}">
                {% else %}
                    <img src="https://via.placeholder.com/300x150.png?text=No+Image" alt="Foto tidak tersedia">
                {% endif %}

                <h3>{{ lapangan.nama }}</h3>
                <p> {{lapangan.kecamatan}} </p>
                <p class="card-rating">
                    <i class="fas fa-star" style="margin-right: 5px;"></i> 
                    {{ lapangan.rating|floatformat:1 }}
                </p>

                <div class="card-buttons">
                    <button 
                        style="background-color: #333;"
                        type="button" 
                        class="btn btn-wishlist" 
                        data-item-id="{{ lapangan.id }}" 
                        data-item-type="lapangan"
                        onclick="toggleWishlist('{{ lapangan.id }}', 'lapangan')">
                        
                        <i id="bookmark-{{ lapangan.id }}" 
                        class="fas fa-bookmark {% if lapangan.is_saved_to_wishlist %}is-saved{% endif %}" 
                        style="color: white">
                        </i>
                    </button>

                    <a href="tel:{{ lapangan.kontak }}" class="btn btn-secondary">Hubungi</a>
                    
                    <button 
                        type="button" 
                        class="btn btn-primary" 
                        onclick="showDetail('{{ lapangan.id }}')">
                        Detail
                    </button>
                    
                </div>
            </div>
            {% empty %}
                <p class="no-data-message">Belum ada data lapangan yang ditambahkan.</p>
            {% endfor %}
        </div>
    </main>


    <div id="modal-overlay" onclick="checkCloseModal(event)">
        <div id="modal-content">
            <button id="modal-close-btn" onclick="hideDetail()">&times;</button>
            
            <img id="modal-image" src="https://via.placeholder.com/600x250.png?text=Loading..." alt="Foto Lapangan">
            
            <div class="modal-body">
                <h2 id="modal-nama">Nama Lapangan</h2>
                
                <!-- <div class="container">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3965.183271344546!2d106.82447380886398!3d-6.370323693593243!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69ec1ad14fb6cf%3A0xc94e4d829420fa15!2sFaculty%20of%20Computer%20Science%2C%20University%20of%20Indonesia!5e0!3m2!1sen!2sid!4v1761140126873!5m2!1sen!2sid" width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div> -->

                <div class="modal-priority-info">
                    <p><i class="fas fa-map-marker-alt"></i> <span id="modal-alamat">Alamat...</span></p>
                    <p><i class="fas fa-location-arrow"></i> <span id="modal-kecamatan">Kecamatan...</span></p>
                    <p><i class="fas fa-star"></i> <span id="modal-rating">Rating...</span></p>
                    <p><i class="fas fa-futbol"></i> <span id="modal-olahraga">Olahraga...</span></p>
                    <p><i class="fas fa-money-bill-wave"></i> <span id="modal-tarif">Tarif...</span></p>
                    <p><i class="fas fa-undo"></i> <span id="modal-refund">Refund...</span></p>
                </div>

                <a id="modal-kontak-btn" href="#" target="_blank">
                    <i class="fas fa-phone"></i> Hubungi
                </a>

                <hr class="modal-divider">
                
                <div class="modal-details">
                    <h4>Deskripsi</h4>
                    <p id="modal-deskripsi">Deskripsi...</p>
                    
                    <h4>Fasilitas</h4>
                    <p id="modal-fasilitas">Fasilitas...</p>
                    
                    <h4>Peraturan</h4>
                    <p id="modal-peraturan">Peraturan...</p>
                    
                    <h4>Review</h4>
                    <p id="modal-review">Review...</p>
                </div>

            </div>
        </div>
    </div>
    <script>
        const modalOverlay = document.getElementById('modal-overlay');
        const modalNama = document.getElementById('modal-nama');
        const modalAlamat = document.getElementById('modal-alamat');
        const modalKecamatan = document.getElementById('modal-kecamatan');
        const modalRating = document.getElementById('modal-rating');
        const modalOlahraga = document.getElementById('modal-olahraga');
        const modalTarif = document.getElementById('modal-tarif');
        const modalRefund = document.getElementById('modal-refund');
        const modalKontakBtn = document.getElementById('modal-kontak-btn');
        const modalImage = document.getElementById('modal-image');
        const modalDeskripsi = document.getElementById('modal-deskripsi');
        const modalFasilitas = document.getElementById('modal-fasilitas');
        const modalPeraturan = document.getElementById('modal-peraturan');
        const modalReview = document.getElementById('modal-review');
        
        async function showDetail(lapanganId) {
            try {
                const response = await fetch(`/json/${lapanganId}/`); 
                if (!response.ok) throw new Error('Data not found');
                
                const data = await response.json();
                
                modalNama.textContent = data.nama;
                modalAlamat.textContent = data.alamat || 'Tidak ada info alamat.';
                modalKecamatan.textContent = data.kecamatan || 'Tidak ada info kecamatan.';
                modalRating.textContent = `${data.rating}`;
                modalOlahraga.textContent = data.olahraga;
                
                const tarif = parseFloat(data.tarif_per_sesi);
                modalTarif.textContent = `Rp ${tarif.toLocaleString('id-ID') || 'N/A'}`;
                
                modalRefund.textContent = data.refund ? 'Bisa Refund' : 'Tidak Bisa Refund';
                
                if (data.kontak) {
                    modalKontakBtn.href = `tel:${data.kontak}`;
                    modalKontakBtn.style.display = 'inline-block';
                } else {
                    modalKontakBtn.style.display = 'none';
                }
                
                modalImage.src = data.thumbnail || 'https://via.placeholder.com/600x250.png?text=No+Image';
                
                modalDeskripsi.textContent = data.deskripsi || 'Tidak ada deskripsi.';
                modalFasilitas.textContent = data.fasilitas || 'Tidak ada info fasilitas.';
                modalPeraturan.textContent = data.peraturan || 'Tidak ada info peraturan.';
                modalReview.textContent = data.review || 'Belum ada review.';

                modalOverlay.style.display = 'flex';

            } catch (error) {
                console.error("Error fetching detail:", error);
                alert("Gagal memuat detail lapangan.");
            }
        }

        function hideDetail() {
            modalOverlay.style.display = 'none';
        }
        
        function checkCloseModal(event) {
            if (event.target === modalOverlay) {
                hideDetail();
            }
        }

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.startsWith(name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        const csrftoken = getCookie('csrftoken');

        async function toggleWishlist(itemId, itemType) {
            try {
                const response = await fetch('/wishlist/toggle/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken
                    },
                    body: JSON.stringify({
                        item_id: itemId,
                        item_type: itemType
                    })
                });

                if (!response.ok) {
                    throw new Error('Server returned an error.');
                }

                const data = await response.json();

                if (data.status === 'added') {
                    updateBookmarkIcon(itemId, 'added');
                    console.log("Item berhasil ditambahkan ke wishlist!");
                } else if (data.status === 'removed') {
                    updateBookmarkIcon(itemId, 'removed');
                    console.log("Item berhasil dihapus dari wishlist!");
                } else {
                    alert("Gagal memperbarui wishlist.");
                }

            } catch (error) {
                console.error("Error toggling wishlist:", error);
                alert("Gagal menghubungi server. Pastikan Anda sudah login.");
            }
        }
        function updateBookmarkIcon(itemId, action) {
            const icon = document.getElementById(`bookmark-${itemId}`);
            if (icon) {
                if (action === 'added') {
                    icon.classList.add('is-saved');
                } else if (action === 'removed') {
                    icon.classList.remove('is-saved');
                }
            }
        }
    </script>
{% endblock content %}